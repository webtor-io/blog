<!DOCTYPE html>
<html
  lang="ru"
  prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"
>
  <head>
    <meta charset="utf-8" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="description" content="" />
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="keywords" content="">


<meta property="og:type" content="article" />
<meta property="og:description" content="" />
<meta property="og:title" content="Технологии внутри Webtor.io" />
<meta property="og:site_name" content="webtor.io" />
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="https://blog.webtor.io/ru/post/%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8-%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B8-webtor.io/" />
<meta property="og:locale" content="ru" />
<meta property="article:published_time" content="2019-10-29
" /> <meta property="article:modified_time" content="2019-10-29
" />






    <title>Технологии внутри Webtor.io</title>
    <link rel="canonical" href="https://blog.webtor.io/ru/post/%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8-%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B8-webtor.io/" />


    <link rel="stylesheet" href="/css/fonts.css" />
<link rel="stylesheet" href="/css/webtor.css" />
<link rel="stylesheet" href="/css/dracula.css" />

<script defer src="https://umami.webtor.io/umami" data-website-id="8407716b-fbd8-43d0-95a1-ba7dfd929f59"></script>

    <link rel="shortcut icon" href="https://webtor.io/assets/night/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="https://webtor.io/assets/night/favicon.svg" >
    <link rel="icon" type="image/png" sizes="16x16" href="https://webtor.io/assets/night/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://webtor.io/assets/night/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="https://webtor.io/assets/night/favicon-48x48.png">

  
    <link rel="alternate" hreflang="en" href="https://blog.webtor.io/en/post/technologies-inside-webtor.io/" title="English">
  

  </head>

<body itemscope itemtype="http://schema.org/Article">
  


<nav class="w-navbar">
  <a href="https://webtor.io" class="w-logo">web<span class="accent">tor</span></a>

  <div class="w-nav-links">
    <a href="/ru/post" class="w-nav-link active">блог</a>
    <a href="/ru/series" class="w-nav-link">серии</a>
  </div>

  <div class="w-lang-switch">
    
      
        <a href="https://blog.webtor.io/en/post/technologies-inside-webtor.io/">EN</a>
      
        <a href="https://blog.webtor.io/ru/post/%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8-%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B8-webtor.io/" class="active">RU</a>
      
    
  </div>
</nav>
<div class="w-navbar-spacer"></div>


  <main class="w-container">
    <h1 class="w-article-title" itemprop="name">Технологии внутри Webtor.io </h1>

    <div class="w-article-meta">
      <span class="w-article-date">29 Октября 2019</span>
      
        <a href="/ru/series/%d1%87%d1%82%d0%be-%d0%b2%d0%bd%d1%83%d1%82%d1%80%d0%b8" class="w-badge w-badge--pink">Что внутри</a>
      
    </div>

    <article class="w-prose" itemprop="articleBody">
      <p><figure><img src="/images/technologies-inside-webtor/kittens.jpg">
</figure>

Периодически мои пользователи интересуются на каких технологиях основан <strong>Webtor</strong>,
использую ли я библиотеку A или утилиту B. На этот раз я хочу развёрнуто и полно
ответить на все вопросы.</p>
<p>Начну с того, что <strong>Webtor</strong> прошел путь длинной в 3 года от монолитного приложения, живущего на выделенном сервере,
до внедрения микросервисов, контейнеризации и переезда в кластер <a href="https://kubernetes.io/">Kubernetes (k8s)</a>.
На текущий момент в кластере работает порядка 10-ти различных сервисов и одновременно выполняется 100+ одновременных
задач по загрузке торрентов и транскодированию контента.</p>
<p>Далее пройдусь по часто задаваемым вопросам.</p>
<h2 id="на-чём-написан-webtor">На чём написан Webtor?</h2>
<p>Почти весь backend построен на <a href="https://golang.org/">Go</a>. Справедливости ради
первый прототип был на <a href="https://nodejs.org">Node.js</a>, но эта затея обернулась неудачей.
Go позволил более эффективно использовать ресурсы и выдерживать большее количество пользователей.
Можно сказать, что именно переход на Go и Kubernetes стали ключевыми техническими решениями для проекта.
Для frontend-а был выбран <a href="https://vuejs.org/">Vue.js</a>.</p>
<h2 id="как-работает-загрузка-торрентов-всё-же-на-webtorrent">Как работает загрузка торрентов? Всё же на WebTorrent?</h2>
<p>В отличии от многих других сервисов <strong>Webtor</strong> построен таким образом, чтобы максимально
быстро предоставить доступ к контенту, не дожидаясь окончания загрузки. Контент
сохраняется на диск только для кэширования и удаляется спустя 5 минут после последнего
обращения. В качестве торрент-клиента используется библиотека на go <a href="https://github.com/anacrolix/torrent">anacrolix/torrent</a>.
Она предоставляет возможность последовательной загрузки и стримминга еще недозагруженного контента.
Для каждой новой загрузки торрента запускается отдельный контейнер в кластере, это позволяет
добиться максимальной изоляции процессов и высокой масштабируемости системы.</p>
<h2 id="для-конвертации-же-используется-ffmpeg-так-ведь">Для конвертации же используется FFmpeg, так ведь?</h2>
<p>Начну немного издалека.</p>
<p>Здесь наверное меня ждало самое сложное испытание. Надо было дать пользователям
возможность проигрывать еще незагруженные avi/mkv/flac-файлы также как они привыкли
делать это ранее, с возможностью перемотки в нужную позицию, выбором субтитров и аудиодорожек.
Каких-то готовых решений я не нашёл, пришлось придумывать свои велосипеды.</p>
<p>Итак как оно работает. Транскодирование начинается с определения длительности контента. На основании этой длительности
формируется HLS-плейлист с указанием на еще несуществующие 10-ти секундные фрагменты. При обращении
к какому-либо из этих фрагментов запускается процесс <a href="https://www.ffmpeg.org/">FFmpeg</a> (да это он!) который
начинает конвертировать необходимый отрезок (при этом загружается только необходимая часть торрента).
Как только отрезок сконвертировался он отдаётся пользователю. Если вдруг пользователь перемотал на другой участок,
то текущий процесс FFmpeg &ldquo;засыпает&rdquo;, а где-то запускается уже новый. Если пользователь вернулся обратно, то старый
процесс находящийся по-близости &ldquo;просыпается&rdquo; и продолжает свою работу. В конце концов получается целое бесшовное видео.
И да, каждая конвертация также запускается в отдельном контейнере.</p>
<p>В идеальных условиях, видео с невысоким разрешением (720p) и достаточным количеством пиров конвертируется без видимых задержек.</p>
<h2 id="я-хочу-установить-webtor-на-свой-сервер-как-мне-это-сделать">Я хочу установить Webtor на свой сервер, как мне это сделать?</h2>
<p>Медленно, но верно ведутся работы по открытию исходного кода проекта. По окончанию каждый желающий сможет
установить <strong>Webtor</strong> в свой локальный кластер Kubernetes.</p>
<p>Спасибо что используете <a href="https://webtor.io/ru/">webtor.io</a> и <a href="https://www.patreon.com/bePatron?u=24145874">поддержите проект</a>!</p>

    </article>

    

    
      
      
      

      
        <section class="w-related">
          <h3 class="w-related__title">Ещё статьи из серии <a href="/ru/series/%d1%87%d1%82%d0%be-%d0%b2%d0%bd%d1%83%d1%82%d1%80%d0%b8">Что внутри</a>  </h3>
          <div class="w-post-list">
            
              <a href="https://blog.webtor.io/ru/post/%D0%B0%D0%BD%D0%BE%D0%BD%D0%B8%D0%BC%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C/" class="w-post-item">
                <div class="w-post-item__title">Анонимность и Безопасность</div>
                <div class="w-post-item__date">22 Декабря 2020</div>
              </a>
            
          </div>
        </section>
      
    
  </main>

  <footer class="w-footer">
  <div class="w-footer__inner">
    <div class="w-footer__left">
      <a href="https://webtor.io" class="w-logo">web<span class="accent">tor</span></a>
      <span class="w-footer__copy">&copy; 2026 webtor.io</span>
    </div>
    <div class="w-footer__links">
      <a href="https://github.com/webtor-io" target="_blank" rel="noopener">GitHub</a>
      <a href="https://www.reddit.com/r/webtor/" target="_blank" rel="noopener">Reddit</a>
      <a href="https://webtor.io" target="_blank" rel="noopener">webtor.io</a>
    </div>
  </div>
</footer>

<script src="/js/highlight.min.js"></script>

<script>
  hljs.initHighlightingOnLoad();
</script>


</body>
</html>
