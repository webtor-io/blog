<!DOCTYPE html>
<html
  class=""
  lang="ru"
  prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"
>
  <head>
    <meta charset="utf-8" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="description" content="" />
<meta name="HandheldFriendly" content="True" />
<meta name="MobileOptimized" content="320" />
<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="keywords" content="">


<meta property="og:type" content="article" />
<meta property="og:description" content="" />
<meta property="og:title" content="Технологии внутри Webtor.io" />
<meta property="og:site_name" content="webtor.io" />
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="https://blog.webtor.io/ru/post/%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8-%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B8-webtor.io/" />
<meta property="og:locale" content="ru" />
<meta property="article:published_time" content="2019-10-29
" /> <meta property="article:modified_time" content="2019-10-29
" />






    <title>Технологии внутри Webtor.io</title>
    <link rel="canonical" href="https://blog.webtor.io/ru/post/%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8-%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B8-webtor.io/" />


    <link
  rel="stylesheet"
  href="https://unpkg.com/tachyons@4.11.1/css/tachyons.min.css"
/>

<link rel="stylesheet" href="/css/style.css" />

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/highlightjs@9.12.0/styles/github-gist.css"
/>



    <link rel="apple-touch-icon" sizes="57x57" href="https://static.webtor.io/icons/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="https://static.webtor.io/icons/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="https://static.webtor.io/icons/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="https://static.webtor.io/icons/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="https://static.webtor.io/icons/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="https://static.webtor.io/icons/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="https://static.webtor.io/icons/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="https://static.webtor.io/icons/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="https://static.webtor.io/icons/apple-touch-icon-180x180.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="webtor.io"><link rel="icon" type="image/png" sizes="32x32" href="https://static.webtor.io/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://static.webtor.io/icons/favicon-16x16.png"><link rel="shortcut icon" href="https://static.webtor.io/icons/favicon.ico"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="https://static.webtor.io/icons/apple-touch-startup-image-320x460.png"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="https://static.webtor.io/icons/apple-touch-startup-image-640x920.png"><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="https://static.webtor.io/icons/apple-touch-startup-image-640x1096.png"><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="https://static.webtor.io/icons/apple-touch-startup-image-750x1294.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="https://static.webtor.io/icons/apple-touch-startup-image-1182x2208.png"><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="https://static.webtor.io/icons/apple-touch-startup-image-1242x2148.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="https://static.webtor.io/icons/apple-touch-startup-image-748x1024.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="https://static.webtor.io/icons/apple-touch-startup-image-768x1004.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="https://static.webtor.io/icons/apple-touch-startup-image-1496x2048.png"><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="https://static.webtor.io/icons/apple-touch-startup-image-1536x2008.png">

  
    <link rel="alternate" hreflang="en" href="https://blog.webtor.io/en/post/technologies-inside-webtor.io/" title="English">
  

  </head>


<body
  lang="ru"
  class="sans-serif w-90 w-80-m w-60-ns center mv2 mv5-ns"
  itemscope
  itemtype="http://schema.org/Article"
>
  
  <span class="b">/ </span>
  <a href="https://webtor.io" class="b bb bw1 pb1 no-underline black">webtor.io</a>
  <span class="b"> / </span>
  <a href="/ru/post" class="b bb bw1 pb1 no-underline black">блог</a>

  <section id="main" class="mt5">
    <h1 itemprop="name" id="title">Технологии внутри Webtor.io </h1>
    <span class="f6 gray">29 Октября 2019</span>

      <article itemprop="articleBody" id="content" class="w-90 lh-copy">
        <p><figure><img src="/images/technologies-inside-webtor/kittens.jpg">
</figure>

Периодически мои пользователи интересуются на каких технологиях основан <strong>Webtor</strong>,
использую ли я библиотеку A или утилиту B. На этот раз я хочу развёрнуто и полно
ответить на все вопросы.</p>
<p>Начну с того, что <strong>Webtor</strong> прошел путь длинной в 3 года от монолитного приложения, живущего на выделенном сервере,
до внедрения микросервисов, контейнеризации и переезда в кластер <a href="https://kubernetes.io/">Kubernetes (k8s)</a>.
На текущий момент в кластере работает порядка 10-ти различных сервисов и одновременно выполняется 100+ одновременных
задач по загрузке торрентов и транскодированию контента.</p>
<p>Далее пройдусь по часто задаваемым вопросам.</p>
<h2 id="на-чём-написан-webtor">На чём написан Webtor?</h2>
<p>Почти весь backend построен на <a href="https://golang.org/">Go</a>. Справедливости ради
первый прототип был на <a href="https://nodejs.org">Node.js</a>, но эта затея обернулась неудачей.
Go позволил более эффективно использовать ресурсы и выдерживать большее количество пользователей.
Можно сказать, что именно переход на Go и Kubernetes стали ключевыми техническими решениями для проекта.
Для frontend-а был выбран <a href="https://vuejs.org/">Vue.js</a>.</p>
<h2 id="как-работает-загрузка-торрентов-всё-же-на-webtorrent">Как работает загрузка торрентов? Всё же на WebTorrent?</h2>
<p>В отличии от многих других сервисов <strong>Webtor</strong> построен таким образом, чтобы максимально
быстро предоставить доступ к контенту, не дожидаясь окончания загрузки. Контент
сохраняется на диск только для кэширования и удаляется спустя 5 минут после последнего
обращения. В качестве торрент-клиента используется библиотека на go <a href="https://github.com/anacrolix/torrent">anacrolix/torrent</a>.
Она предоставляет возможность последовательной загрузки и стримминга еще недозагруженного контента.
Для каждой новой загрузки торрента запускается отдельный контейнер в кластере, это позволяет
добиться максимальной изоляции процессов и высокой масштабируемости системы.</p>
<h2 id="для-конвертации-же-используется-ffmpeg-так-ведь">Для конвертации же используется FFmpeg, так ведь?</h2>
<p>Начну немного издалека.</p>
<p>Здесь наверное меня ждало самое сложное испытание. Надо было дать пользователям
возможность проигрывать еще незагруженные avi/mkv/flac-файлы также как они привыкли
делать это ранее, с возможностью перемотки в нужную позицию, выбором субтитров и аудиодорожек.
Каких-то готовых решений я не нашёл, пришлось придумывать свои велосипеды.</p>
<p>Итак как оно работает. Транскодирование начинается с определения длительности контента. На основании этой длительности
формируется HLS-плейлист с указанием на еще несуществующие 10-ти секундные фрагменты. При обращении
к какому-либо из этих фрагментов запускается процесс <a href="https://www.ffmpeg.org/">FFmpeg</a> (да это он!) который
начинает конвертировать необходимый отрезок (при этом загружается только необходимая часть торрента).
Как только отрезок сконвертировался он отдаётся пользователю. Если вдруг пользователь перемотал на другой участок,
то текущий процесс FFmpeg &ldquo;засыпает&rdquo;, а где-то запускается уже новый. Если пользователь вернулся обратно, то старый
процесс находящийся по-близости &ldquo;просыпается&rdquo; и продолжает свою работу. В конце концов получается целое бесшовное видео.
И да, каждая конвертация также запускается в отдельном контейнере.</p>
<p>В идеальных условиях, видео с невысоким разрешением (720p) и достаточным количеством пиров конвертируется без видимых задержек.</p>
<h2 id="я-хочу-установить-webtor-на-свой-сервер-как-мне-это-сделать">Я хочу установить Webtor на свой сервер, как мне это сделать?</h2>
<p>Медленно, но верно ведутся работы по открытию исходного кода проекта. По окончанию каждый желающий сможет
установить <strong>Webtor</strong> в свой локальный кластер Kubernetes.</p>
<p>Спасибо что используете <a href="https://webtor.io/ru/">webtor.io</a> и <a href="https://www.patreon.com/bePatron?u=24145874">поддержите проект</a>!</p>

      </article>

      
      <span class="f6 gray mv3" title="Lastmod: October 29, 2019. Published at: 2019-10-29.">
        
      </span>

      
        <section class="mt4">
          
          
          
          <h3>👋 Ещё статьи из серии <a href="/ru/series/%d1%87%d1%82%d0%be-%d0%b2%d0%bd%d1%83%d1%82%d1%80%d0%b8" class="b bb bw1 pb1 no-underline black">Что внутри</a>  </h3>
      
          
         
          
            <ul class="list pl0">
              
                <li class="list pl0 lh-copy">
                  <a
                    class="f4 b dib black no-underline"
                    href="https://blog.webtor.io/ru/post/%D0%B0%D0%BD%D0%BE%D0%BD%D0%B8%D0%BC%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C/"
                    >Анонимность и Безопасность</a
                  >
                  <span class="f6 gray">22 Декабря 2020</span>
                </li>
              
            </ul>  
          
        </section>
      

  </section>

  <footer>
    <div>
      <p class="f6 gray mt6 lh-copy">
        
      </p>
    </div>
  </footer>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.14.2/highlight.min.js"></script>

<script>
  hljs.initHighlightingOnLoad();
</script>



  </body>
</html>
